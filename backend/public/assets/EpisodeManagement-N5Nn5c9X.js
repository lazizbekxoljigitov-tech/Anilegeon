import{a as h,j as e,B as y,I as l}from"./index-C5JwLfAb.js";import{v as Y,e as Z,r as a,z as i,D as ee,al as se,P as ae,y as te,a6 as re,ai as F,A as le,m as M,X as ie,aJ as de}from"./vendor-ui-BWBM4E-P.js";import{s as R}from"./supabase-BDdCNlIp.js";import{u as oe}from"./i18n-lib-Bl3zpvLj.js";const xe=()=>{const{animeId:o}=Y(),A=Z(),[g,O]=a.useState(null),[b,T]=a.useState([]),[q,N]=a.useState(!0),{t:p}=oe(),[B,u]=a.useState(!1),[n,k]=a.useState(!1),[r,m]=a.useState({title:"",episode_number:"",duration:"24"}),[c,w]=a.useState(null),[f,U]=a.useState(""),[_,S]=a.useState(""),[C,E]=a.useState(""),[D,z]=a.useState(""),[d,P]=a.useState("file"),[I,x]=a.useState(0);a.useEffect(()=>{j()},[o]);const j=async()=>{N(!0);try{const{data:s}=await h.get(`/anime/${o}`);O(s.data);const{data:t}=await h.get(`/episodes/anime/${o}`);T(t.data)}catch{i.error("Failed to load episodes")}finally{N(!1)}},J=async s=>{if(s.preventDefault(),d==="file"&&!c)return i.error("Please select a video file");if(d==="url"&&!f)return i.error("Please enter a video URL");k(!0),x(0);try{let t=f;if(d==="file"&&c){const L=c,G=L.name.split(".").pop(),V=`episodes/${o}/${Date.now()}-${Math.random().toString(36).substring(2)}.${G}`,H=setInterval(()=>{x(v=>v<90?v+5:v)},1e3),{data:ne,error:$}=await R.storage.from("videos").upload(V,L,{cacheControl:"3600",upsert:!0});if(clearInterval(H),$)throw $;x(100);const{data:{publicUrl:W}}=R.storage.from("videos").getPublicUrl(V);t=W}const X={anime_id:o,title:r.title,episode_number:Number(r.episode_number),duration:Number(r.duration),video_url:t,video_url_720p:_,video_url_1080p:C,video_url_4k:D};await h.post("/episodes",X),i.success("Episode successfully added to library!"),u(!1),K(),j()}catch(t){console.error("Operation Failed:",t),i.error(t.message||"Error occurred during upload or save")}finally{k(!1),x(0)}},K=()=>{m({title:"",episode_number:"",duration:"24"}),w(null),U(""),S(""),E(""),z("")},Q=async s=>{if(window.confirm("Delete this episode? This cannot be undone."))try{await h.delete(`/episodes/${s}`),i.success("Episode deleted successfully"),j()}catch{i.error("Failed to delete episode")}};return e.jsxs("div",{className:"space-y-12",children:[e.jsxs("header",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>A("/admin/anime"),className:"p-2 bg-dark-accent hover:bg-dark-border rounded-xl transition-all",children:e.jsx(ee,{size:24})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-4xl font-black italic uppercase tracking-tighter mb-1",children:[(g==null?void 0:g.title)||"Anime"," ",e.jsx("span",{className:"text-primary italic",children:"Episodes"})]}),e.jsxs("p",{className:"text-gray-500 font-medium",children:[b.length," Episodes total"]})]})]}),e.jsxs(y,{onClick:()=>u(!0),className:"shadow-xl shadow-primary/20",children:[e.jsx(se,{size:20}),p("admin.upload_episode")]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:q?[1,2,3].map(s=>e.jsx("div",{className:"h-20 bg-dark-accent rounded-2xl animate-pulse"},s)):b.length>0?b.sort((s,t)=>s.episode_number-t.episode_number).map(s=>e.jsxs("div",{className:"group flex items-center gap-6 p-4 bg-dark-light/40 border border-dark-border/50 rounded-2xl hover:border-primary/30 transition-all",children:[e.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-xl flex items-center justify-center text-primary group-hover:scale-110 transition-transform",children:e.jsx(ae,{size:24,className:"fill-primary"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("h4",{className:"font-bold text-lg",children:[e.jsxs("span",{className:"text-primary mr-2",children:["EP ",s.episode_number,":"]}),s.title||"Untitled Episode"]}),e.jsx("div",{className:"flex items-center gap-4 mt-1",children:e.jsxs("span",{className:"text-xs font-bold text-gray-500 uppercase tracking-widest flex items-center gap-1",children:[e.jsx(te,{size:12}),s.duration," Minutes"]})})]}),e.jsx("button",{onClick:()=>Q(s.id),className:"p-3 text-gray-500 hover:text-red-500 hover:bg-red-500/10 rounded-xl transition-all",children:e.jsx(re,{size:20})})]},s.id)):e.jsxs("div",{className:"py-24 text-center bg-dark-light/20 rounded-3xl border border-dark-border/30",children:[e.jsx(F,{size:48,className:"mx-auto text-gray-700 mb-4"}),e.jsx("p",{className:"text-gray-500 font-bold uppercase tracking-widest text-sm",children:"No episodes uploaded yet"})]})}),e.jsx(le,{children:B&&e.jsx("div",{className:"fixed inset-0 z-[60] flex items-center justify-center p-6 bg-black/80 backdrop-blur-sm",children:e.jsxs(M.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-dark-bg border border-dark-border w-full max-w-lg rounded-3xl shadow-2xl p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("h2",{className:"text-2xl font-black italic uppercase tracking-tighter",children:["Upload ",e.jsx("span",{className:"text-primary",children:"Episode"})]}),e.jsx("button",{onClick:()=>u(!1),className:"p-2 text-gray-500 hover:text-white bg-dark-accent rounded-xl",children:e.jsx(ie,{size:20})})]}),e.jsxs("form",{onSubmit:J,className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{label:"Episode Number",type:"number",required:!0,value:r.episode_number,onChange:s=>m({...r,episode_number:s.target.value})}),e.jsx(l,{label:"Duration (Min)",type:"number",required:!0,value:r.duration,onChange:s=>m({...r,duration:s.target.value})})]}),e.jsx(l,{label:p("admin.episode_title_label")||"Episode Title (Optional)",placeholder:"e.g. The Beginning",value:r.title,onChange:s=>m({...r,title:s.target.value})}),e.jsxs("div",{className:"flex bg-dark-accent p-1 rounded-xl gap-1",children:[e.jsx("button",{type:"button",onClick:()=>P("file"),className:`flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all ${d==="file"?"bg-primary text-white shadow-lg shadow-primary/20":"text-gray-500 hover:text-white"}`,children:p("admin.upload_mode_file")}),e.jsx("button",{type:"button",onClick:()=>P("url"),className:`flex-1 py-2 rounded-lg text-xs font-bold uppercase transition-all ${d==="url"?"bg-primary text-white shadow-lg shadow-primary/20":"text-gray-500 hover:text-white"}`,children:p("admin.upload_mode_url")})]}),d==="file"?e.jsxs("div",{className:"space-y-1.5",children:[e.jsx("label",{className:"text-sm font-medium text-gray-400 ml-1",children:"Video File"}),e.jsxs("div",{className:"relative group h-32 rounded-2xl border-2 border-dashed border-dark-border bg-dark-accent flex flex-col items-center justify-center overflow-hidden hover:border-primary/50 transition-all",children:[c?e.jsxs("div",{className:"flex flex-col items-center text-primary",children:[e.jsx(F,{size:32}),e.jsx("span",{className:"text-xs font-bold uppercase mt-2 truncate max-w-[200px]",children:c.name})]}):e.jsxs("div",{className:"flex flex-col items-center text-gray-500",children:[e.jsx(de,{size:32}),e.jsx("span",{className:"text-xs font-bold uppercase mt-2",children:"Select Video"})]}),e.jsx("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",accept:"video/*",onChange:s=>{var t;return w(((t=s.target.files)==null?void 0:t[0])||null)}})]})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(l,{label:"Default Video URL (Required)",placeholder:"https://cdn.example.com/video.mp4",required:!0,value:f,onChange:s=>U(s.target.value)}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 p-4 bg-dark-accent/30 rounded-2xl border border-dark-border/50",children:[e.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-gray-500 mb-2",children:"Multi-Quality Links (Optional)"}),e.jsx(l,{label:"720p URL",placeholder:"https://...",value:_,onChange:s=>S(s.target.value)}),e.jsx(l,{label:"1080p URL",placeholder:"https://...",value:C,onChange:s=>E(s.target.value)}),e.jsx(l,{label:"4K (AI) URL",placeholder:"https://...",value:D,onChange:s=>z(s.target.value)})]})]}),n&&e.jsxs("div",{className:"space-y-2 pt-2",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold uppercase text-gray-500",children:[e.jsx("span",{children:"Uploading..."}),e.jsxs("span",{children:[I,"%"]})]}),e.jsx("div",{className:"h-2 bg-dark-accent rounded-full overflow-hidden",children:e.jsx(M.div,{className:"h-full bg-primary",initial:{width:0},animate:{width:`${I}%`}})})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4",children:[e.jsx(y,{variant:"ghost",type:"button",onClick:()=>u(!1),disabled:n,children:"Cancel"}),e.jsx(y,{type:"submit",isLoading:n,className:"px-10 h-14 rounded-xl",disabled:n,children:n?"Uploading...":"Start Upload"})]})]})]})})})]})};export{xe as AdminEpisodes};
