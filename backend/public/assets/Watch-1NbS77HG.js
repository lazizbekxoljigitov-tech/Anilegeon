import{j as e,B as f,a as d}from"./index-C5JwLfAb.js";import{v as j,r as l,e as v,L as p,D as N,x as w,E as y,J as k,q as _,z as x}from"./vendor-ui-BWBM4E-P.js";import{V as E}from"./VideoPlayer-Dilu5wCp.js";import{E as I}from"./EpisodeList-BoCBJJEO.js";import"./i18n-lib-Bl3zpvLj.js";const q=()=>{var m;const{id:r}=j(),[a,h]=l.useState(null),[s,u]=l.useState(null),[g,c]=l.useState(!0),n=v();l.useEffect(()=>{(async()=>{c(!0);try{const{data:i}=await d.get(`/episodes/${r}`);if(i.success){h(i.data);const o=await d.get(`/anime/${i.data.anime_id}`);u(o.data.data),d.post("/anime/view",{anime_id:i.data.anime_id,episode_id:r}).catch(console.error),d.post("/users/history",{anime_id:i.data.anime_id,episode_id:r,progress:0}).catch(()=>{})}}catch{x.error("Failed to load video player"),n("/")}finally{c(!1)}})(),window.scrollTo(0,0)},[r,n]);const b=()=>{var i;if(!s||!a)return;const t=((i=s.episodes)==null?void 0:i.findIndex(o=>o.id===a.id))??-1;t!==-1&&s.episodes&&t<s.episodes.length-1?n(`/watch/${s.episodes[t+1].id}`):x.success("You have reached the latest episode!")};return g?e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsx("div",{className:"aspect-video w-full bg-dark-accent rounded-3xl animate-pulse mb-12"}),e.jsx("div",{className:"h-10 w-1/2 bg-dark-accent rounded mb-6"}),e.jsx("div",{className:"h-40 w-full bg-dark-accent rounded"})]}):!a||!s?null:e.jsxs("div",{className:"container mx-auto px-6",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx(p,{to:`/anime/${s.id}`,"aria-label":`Go back to ${s.title} details`,className:"p-2 bg-dark-accent hover:bg-dark-border rounded-full transition-colors",children:e.jsx(N,{size:24})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-black italic uppercase tracking-tighter",children:s.title}),e.jsxs("p",{className:"text-sm text-primary font-bold uppercase tracking-widest",children:["Episode ",a.episode_number,": ",a.title||"Untitled"]})]})]}),e.jsx("section",{className:"mb-12",children:e.jsx(E,{url:a.video_url||"",qualities:{"720p":a.video_url_720p,"1080p":a.video_url_1080p,"4k":a.video_url_4k},title:`${s.title} - Episode ${a.episode_number}`,onEnded:b})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-12",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-12",children:[e.jsxs("section",{className:"bg-dark-light/20 border border-dark-border/30 rounded-3xl p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-black italic uppercase tracking-tighter",children:"Episode Info"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsxs("button",{"aria-label":"Share this episode",className:"flex items-center gap-2 text-gray-500 hover:text-white transition-colors",children:[e.jsx(w,{size:20}),e.jsx("span",{className:"text-sm font-bold uppercase",children:"Share"})]}),e.jsxs("button",{"aria-label":"Report an issue with this video",className:"flex items-center gap-2 text-gray-500 hover:text-white transition-colors",children:[e.jsx(y,{size:20}),e.jsx("span",{className:"text-sm font-bold uppercase",children:"Report"})]})]})]}),e.jsxs("p",{className:"text-gray-400 leading-relaxed",children:["You are watching ",e.jsx("span",{className:"text-white font-bold",children:s.title})," Episode ",a.episode_number,". If the video is buffering or not loading, try refreshing the page or checking your connection. Our servers provide high-definition streaming for the best viewing experience."]})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-8",children:[e.jsx("div",{className:"w-10 h-10 bg-primary/20 rounded-xl flex items-center justify-center",children:e.jsx(k,{size:22,className:"text-primary"})}),e.jsx("h3",{className:"text-2xl font-black italic uppercase tracking-tighter",children:"Selection"})]}),e.jsx(I,{animeId:s.id,episodes:s.episodes||[],currentEpisodeId:a.id})]})]}),e.jsx("div",{className:"space-y-12",children:e.jsxs("section",{className:"bg-dark-light/30 border border-dark-border/50 rounded-2xl p-8 overflow-hidden relative",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/10 rounded-full blur-3xl -mr-16 -mt-16"}),e.jsx("img",{src:s.thumbnail_url,className:"w-full aspect-[2/3] object-cover rounded-xl mb-6 shadow-xl"}),e.jsx("h4",{className:"text-lg font-bold mb-4 line-clamp-1",children:s.title}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:(m=s.anime_categories)==null?void 0:m.slice(0,3).map(t=>e.jsx("span",{className:"text-[10px] font-bold uppercase px-2 py-0.5 bg-white/5 border border-white/10 rounded-md text-gray-400",children:t.categories.name},t.category_id))}),e.jsx(p,{to:`/anime/${s.id}`,children:e.jsxs(f,{variant:"outline",className:"w-full",children:[e.jsx(_,{size:18}),"Anime Details"]})})]})})]})]})};export{q as Watch};
