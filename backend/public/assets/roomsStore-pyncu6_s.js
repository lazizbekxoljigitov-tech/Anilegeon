import{c as m,p as c}from"./index-CRKTpU-g.js";import{z as t}from"./vendor-ui-BWBM4E-P.js";const d=()=>`ANIME-${Math.floor(1e4+Math.random()*9e4)}`,p=()=>{const a=["https://api.dicebear.com/7.x/avataaars/svg?seed=Felix","https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka","https://api.dicebear.com/7.x/avataaars/svg?seed=Mark","https://api.dicebear.com/7.x/avataaars/svg?seed=Saitama","https://api.dicebear.com/7.x/avataaars/svg?seed=Naruto"];return a[Math.floor(Math.random()*a.length)]},R=m()(c((a,o)=>({user:null,initUser:e=>{const r=o();if(r.user){e&&(r.user.username!==e.name||r.user.avatar!==e.avatar_url)&&a({user:{...r.user,username:e.name||r.user.username,avatar:e.avatar_url||r.user.avatar}});return}a({user:{id:(e==null?void 0:e.id)||d(),username:(e==null?void 0:e.name)||`Guest-${Math.floor(Math.random()*1e3)}`,avatar:(e==null?void 0:e.avatar_url)||p(),isOnline:!0}})},updateStatus:e=>{const{user:r}=o();r&&a({user:{...r,isOnline:e}})},setRoom:e=>{const{user:r}=o();r&&a({user:{...r,currentRoomId:e}})}}),{name:"watch-party-user-storage"})),u={"ANIME-ADMIN":{username:"Admin-San",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Admin"},"ANIME-DEMO1":{username:"Naruto Fan",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Naruto"},"ANIME-DEMO2":{username:"Mikasa",avatar:"https://api.dicebear.com/7.x/avataaars/svg?seed=Mikasa"}},g=m()(c((a,o)=>({friends:[],pendingInvites:[],addFriend:async e=>{if(await new Promise(n=>setTimeout(n,1e3)),o().friends.find(n=>n.id===e))throw new Error("User is already your friend");let s;if(u[e])s={id:e,...u[e],status:"online"};else if(e.startsWith("ANIME-")&&e.length>6){const n=e.split("-")[1];s={id:e,username:`User-${n}`,avatar:`https://api.dicebear.com/7.x/avataaars/svg?seed=${n}`,status:"offline",lastSeen:"Just now"}}else throw new Error("User not found. Check the ID and try again.");return a(n=>({friends:[...n.friends,s]})),!0},removeFriend:e=>{a(r=>({friends:r.friends.filter(s=>s.id!==e)}))},updateFriendStatus:(e,r,s)=>{a(n=>({friends:n.friends.map(i=>i.id===e?{...i,status:r,roomId:s}:i)}))},inviteFriend:e=>{a(r=>({pendingInvites:[...r.pendingInvites,e]})),setTimeout(()=>{a(r=>({pendingInvites:r.pendingInvites.filter(s=>s!==e)}))},3e3)}}),{name:"watch-party-friends-storage"})),l=()=>{const a="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let o="ROOM-";for(let e=0;e<4;e++)o+=a.charAt(Math.floor(Math.random()*a.length));return o},M=m()(c((a,o)=>({currentRoom:null,isRoomLoading:!1,createRoom:async e=>{a({isRoomLoading:!0}),await new Promise(n=>setTimeout(n,1500));const r=l(),s={id:r,hostId:e.id,isPlaying:!1,currentTime:0,participants:[{...e,role:"owner",isMuted:!0,isCameraOn:!1}]};return a({currentRoom:s,isRoomLoading:!1}),r},joinRoom:async(e,r)=>{if(a({isRoomLoading:!0}),await new Promise(s=>setTimeout(s,1500)),!e.startsWith("ROOM-"))throw a({isRoomLoading:!1}),new Error("Invalid Room ID format");a(s=>{var n;return{currentRoom:{...s.currentRoom||{id:e,hostId:"unknown",isPlaying:!1,currentTime:0,participants:[]},participants:[...((n=s.currentRoom)==null?void 0:n.participants)||[],{...r,role:"viewer",isMuted:!0,isCameraOn:!1}]},isRoomLoading:!1}})},leaveRoom:()=>{a({currentRoom:null}),t.success("Left the room")},kickParticipant:e=>{a(r=>r.currentRoom?{currentRoom:{...r.currentRoom,participants:r.currentRoom.participants.filter(s=>s.id!==e)}}:{}),t.success("User kicked from room")},updateRoomState:e=>{a(r=>r.currentRoom?{currentRoom:{...r.currentRoom,...e}}:{})},updateAnime:e=>{a(r=>r.currentRoom?{currentRoom:{...r.currentRoom,animeId:e,isPlaying:!1,currentTime:0}}:{}),t.success("Anime updated for room")},inviteUser:e=>{t.success(`Invite sent to ${e.username}`)}}),{name:"watch-party-rooms-storage",partialize:a=>({currentRoom:a.currentRoom})}));export{g as a,M as b,R as u};
