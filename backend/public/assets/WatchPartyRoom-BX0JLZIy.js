var le=Object.defineProperty;var ne=(a,t,x)=>t in a?le(a,t,{enumerable:!0,configurable:!0,writable:!0,value:x}):a[t]=x;var V=(a,t,x)=>ne(a,typeof t!="symbol"?t+"":t,x);import{j as e,a as ee,u as oe,N as ce}from"./index-CRKTpU-g.js";import{r as i,an as P,ao as R,ai as de,ap as xe,aq as me,z as L,ar as Y,m as b,A as T,as as he,at as ue,au as pe,X as K,a9 as U,av as be,S as _,af as W,P as B,a5 as te,v as fe,e as ge,a1 as je,ac as ye,a6 as X,x as ve,aw as F,k as G,c as J}from"./vendor-ui-BWBM4E-P.js";import{b as E,u as $,a as we}from"./roomsStore-pyncu6_s.js";import{V as Ne}from"./VideoPlayer-DfzrlTVg.js";import{$ as ke,l as Ce}from"./watch-party-lib-BIJ0g69o.js";import{u as Se}from"./i18n-lib-Bl3zpvLj.js";const ze=({animeId:a})=>{var c;const{currentRoom:t,updateRoomState:x}=E(),{user:r}=$(),[n,m]=i.useState(null);return i.useEffect(()=>{a&&a!=="demo"&&(async()=>{var f;try{const{data:h}=await ee.get(`/anime/${a}`);h.success&&((f=h.data.episodes)==null?void 0:f.length)>0&&m(h.data.episodes[0])}catch(h){console.error("Failed to fetch anime for sync player:",h)}})()},[a]),!n&&a!=="demo"?e.jsx("div",{className:"w-full aspect-video bg-dark-bg rounded-2xl flex items-center justify-center border border-white/5 animate-pulse",children:e.jsx("span",{className:"text-gray-500 font-bold uppercase tracking-widest",children:"Loading Media..."})}):e.jsxs("div",{className:"w-full",children:[e.jsx(Ne,{url:(n==null?void 0:n.video_url)||"https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",qualities:{"720p":n==null?void 0:n.video_url_720p,"1080p":n==null?void 0:n.video_url_1080p,"4k":n==null?void 0:n.video_url_4k},title:`WATCH PARTY • ${(n==null?void 0:n.title)||"Shared Stream"}`,isSyncing:!0,externalState:{currentTime:(t==null?void 0:t.currentTime)||0,isPlaying:(t==null?void 0:t.isPlaying)||!1,lastUpdate:Date.now()},onStateChange:o=>{(t==null?void 0:t.hostId)===(r==null?void 0:r.id)&&x(o)}}),e.jsxs("div",{className:"flex items-center gap-3 mt-4 px-2",children:[e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1 bg-primary/10 border border-primary/20 rounded-full",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t!=null&&t.isPlaying?"bg-green-500 animate-pulse":"bg-yellow-500"}`}),e.jsx("span",{className:"text-[10px] font-black uppercase text-primary",children:"Synced Room"})]}),e.jsxs("span",{className:"text-[10px] font-bold text-gray-500 uppercase tracking-widest",children:[((c=t==null?void 0:t.participants)==null?void 0:c.length)||0," Viewers Connected"]})]})]})};class Te{constructor(){V(this,"peer",null);V(this,"myStream",null)}initialize(t){this.peer=new ke(t,{host:"0.peerjs.com",port:443,path:"/",secure:!0}),this.peer.on("open",x=>{console.log("My peer ID is: "+x)})}async getLocalStream(){try{return this.myStream=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),this.myStream}catch(t){return console.error("Failed to get local stream",t),null}}callUser(t,x){return this.peer?this.peer.call(t,x):void 0}answerCall(t,x){return t.answer(x),t}destroy(){this.myStream&&this.myStream.getTracks().forEach(t=>t.stop()),this.peer&&this.peer.destroy()}}const w=new Te,Ie=()=>{const{currentRoom:a}=E(),{user:t}=$(),x=(a==null?void 0:a.participants)||[],[r,n]=i.useState(!0),[m,c]=i.useState(!1),[o,f]=i.useState(!1),h=i.useRef(null),y=i.useRef(null),v=i.useRef(null),g=i.useRef();i.useEffect(()=>{if(w.myStream&&r)try{const d=new AudioContext,S=d.createAnalyser();S.fftSize=256,d.createMediaStreamSource(w.myStream).connect(S),y.current=d,v.current=S;const z=new Uint8Array(S.frequencyBinCount),I=()=>{S.getByteFrequencyData(z);const M=z.reduce((s,p)=>s+p,0)/z.length;f(M>15),g.current=requestAnimationFrame(I)};I()}catch{}return()=>{var d;g.current&&cancelAnimationFrame(g.current),(d=y.current)==null||d.close()}},[r]),i.useEffect(()=>{h.current&&w.myStream&&(h.current.srcObject=w.myStream)},[m,r]);const k=()=>{if(w.myStream){const d=w.myStream.getAudioTracks()[0];d&&(d.enabled=!r,n(!r))}else L.error("Microphone not available")},l=()=>{if(w.myStream){const d=w.myStream.getVideoTracks()[0];d&&(d.enabled=!m)}c(!m)},u=()=>{w.destroy(),n(!1),c(!1),L.success("Disconnected from voice")};return e.jsxs("div",{className:"h-full bg-white/[0.02] backdrop-blur-sm rounded-2xl border border-white/[0.06] p-4 flex flex-col gap-4 overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-white font-bold text-sm flex items-center gap-2",children:["Voice & Video",e.jsx("span",{className:"text-[10px] text-gray-500 bg-white/[0.06] px-2 py-0.5 rounded-full",children:x.length})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:k,className:`p-2.5 rounded-xl transition-all duration-200 border ${r?o?"bg-green-500/20 text-green-400 border-green-500/30 shadow-lg shadow-green-500/20":"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,title:r?"Mute":"Unmute",children:r?e.jsx(P,{size:16}):e.jsx(R,{size:16})}),e.jsx("button",{onClick:l,className:`p-2.5 rounded-xl transition-all duration-200 border ${m?"bg-green-500/10 text-green-400 border-green-500/20":"bg-red-500/10 text-red-400 border-red-500/20"}`,title:m?"Turn off camera":"Turn on camera",children:m?e.jsx(de,{size:16}):e.jsx(xe,{size:16})}),e.jsx("button",{onClick:u,className:"p-2.5 rounded-xl bg-red-500/10 border border-red-500/20 text-red-400 hover:bg-red-500/20 transition-all duration-200",title:"Leave Voice",children:e.jsx(me,{size:16})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:[e.jsxs("div",{className:`relative aspect-video bg-[#111118] rounded-xl overflow-hidden group border-2 transition-all duration-300 ${o&&r?"border-purple-500 shadow-lg shadow-purple-500/20":"border-white/[0.06]"}`,children:[e.jsx("div",{className:"w-full h-full flex items-center justify-center absolute inset-0 z-0",children:e.jsxs("div",{className:`relative transition-all duration-300 ${o&&r?"scale-110":""}`,children:[e.jsx("img",{src:t==null?void 0:t.avatar,alt:t==null?void 0:t.username,className:`w-12 h-12 rounded-full border-2 transition-all duration-300 ${o&&r?"border-purple-500 shadow-[0_0_20px_rgba(168,85,247,0.5)]":r?"border-green-500/40":"border-white/10"}`}),o&&r&&e.jsx("div",{className:"absolute inset-0 rounded-full border-2 border-purple-400 animate-ping opacity-30"})]})}),e.jsx("video",{ref:h,autoPlay:!0,muted:!0,className:`w-full h-full object-cover relative z-10 transition-opacity duration-300 ${m?"opacity-100":"opacity-0"}`}),e.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex items-center justify-between z-20",children:[e.jsx("span",{className:"text-[10px] font-bold text-white bg-black/60 px-2 py-0.5 rounded-md backdrop-blur-sm",children:"You"}),e.jsx("div",{className:`p-1 rounded-full transition-all ${r?"bg-green-500/80 text-white":"bg-black/60 text-red-400"}`,children:r?e.jsx(P,{size:9}):e.jsx(R,{size:9})})]})]}),x.filter(d=>d.id!==(t==null?void 0:t.id)).map(d=>e.jsxs("div",{className:"relative aspect-video bg-[#111118] rounded-xl overflow-hidden group border-2 border-white/[0.06] transition-all",children:[e.jsx("div",{className:"w-full h-full flex items-center justify-center",children:e.jsx("img",{src:d.avatar,alt:d.username,className:"w-12 h-12 rounded-full border-2 border-white/10"})}),e.jsxs("div",{className:"absolute bottom-2 left-2 right-2 flex items-center justify-between",children:[e.jsx("span",{className:"text-[10px] font-bold text-white bg-black/60 px-2 py-0.5 rounded-md truncate backdrop-blur-sm",children:d.username}),e.jsx("div",{className:`p-1 rounded-full ${d.isMuted?"bg-black/60 text-red-400":"bg-green-500/80 text-white"}`,children:d.isMuted?e.jsx(R,{size:9}):e.jsx(P,{size:9})})]})]},d.id))]})]})},Le="http://localhost:5000/api",N=Ce(Le,{autoConnect:!1,reconnection:!0}),Ae=()=>{N.connected||N.connect()},O=()=>{N.connected&&N.disconnect()},Ee=(a,t)=>{N.emit("room:join",{roomId:a,user:t})},Q=()=>{const{user:a}=$(),[t,x]=i.useState([]),[r,n]=i.useState(""),[m,c]=i.useState(!0),[o,f]=i.useState(0),[h,y]=i.useState([]),v=i.useRef(null),g=i.useRef(null),k=i.useRef(null),l=i.useRef(),u=500,d=i.useCallback(()=>{var s;(s=g.current)==null||s.scrollIntoView({behavior:"smooth"}),f(0)},[]),S=()=>{const s=v.current;if(!s)return;const C=s.scrollHeight-s.scrollTop-s.clientHeight<80;c(C),C&&f(0)};i.useEffect(()=>(N.on("chat:message",s=>{x(p=>[...p,s]),m||f(p=>p+1)}),N.on("chat:typing",s=>{y(p=>p.includes(s)?p:[...p,s]),setTimeout(()=>{y(p=>p.filter(C=>C!==s))},3e3)}),()=>{N.off("chat:message"),N.off("chat:typing")}),[m]),i.useEffect(()=>{m&&d()},[t,m,d]);const A=()=>{l.current&&clearTimeout(l.current),N.emit("chat:typing",{username:a==null?void 0:a.username}),l.current=setTimeout(()=>{},3e3)},z=()=>{const s=k.current;s&&(s.style.height="40px",s.style.height=Math.min(s.scrollHeight,120)+"px")},I=s=>{s==null||s.preventDefault();const p=r.trim();!p||!a||(N.emit("chat:message",{content:p}),n(""),k.current&&(k.current.style.height="40px"))},M=s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),I())};return e.jsxs("div",{className:"flex flex-col h-full bg-white/[0.02] backdrop-blur-sm rounded-2xl border border-white/[0.06] overflow-hidden",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-white/[0.06] flex items-center justify-between bg-white/[0.03]",children:[e.jsx("h3",{className:"font-bold text-white uppercase tracking-wider text-xs",children:"Live Chat"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-red-500 animate-pulse"}),e.jsx("span",{className:"text-[10px] text-red-400 font-bold tracking-wider",children:"LIVE"})]})]}),e.jsxs("div",{ref:v,onScroll:S,className:"flex-1 overflow-y-auto px-4 py-3 space-y-3 custom-scrollbar relative",children:[t.length===0&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 bg-white/[0.04] rounded-2xl flex items-center justify-center mb-3",children:e.jsx(Y,{size:20,className:"text-gray-600"})}),e.jsx("p",{className:"text-gray-500 text-xs",children:"Start the conversation!"})]}),t.map((s,p)=>{const C=s.userId===(a==null?void 0:a.id);return s.isSystem?e.jsx("div",{className:"flex justify-center my-2",children:e.jsx("span",{className:"text-[10px] text-gray-500 bg-white/[0.04] px-3 py-1 rounded-full border border-white/[0.04]",children:s.content})},s.id||p):e.jsxs(b.div,{initial:{opacity:0,y:8,scale:.98},animate:{opacity:1,y:0,scale:1},transition:{duration:.15},className:`flex items-start gap-2.5 ${C?"flex-row-reverse":""}`,children:[e.jsx("img",{src:s.avatar,alt:s.username,className:"w-7 h-7 rounded-full bg-dark-bg shrink-0 mt-0.5"}),e.jsxs("div",{className:`flex flex-col ${C?"items-end":"items-start"} max-w-[80%]`,children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-0.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400",children:C?"You":s.username}),e.jsx("span",{className:"text-[9px] text-gray-600",children:new Date(s.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:`px-3.5 py-2 rounded-2xl text-sm leading-relaxed ${C?"bg-purple-500/20 text-purple-100 rounded-tr-sm border border-purple-500/10":"bg-white/[0.06] text-gray-200 rounded-tl-sm border border-white/[0.04]"}`,children:s.content})]})]},s.id||p)}),e.jsx("div",{ref:g})]}),e.jsx(T,{children:!m&&o>0&&e.jsxs(b.button,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:10},onClick:d,className:"absolute bottom-20 left-1/2 -translate-x-1/2 flex items-center gap-1.5 px-4 py-2 bg-purple-500 text-white text-xs font-bold rounded-full shadow-lg shadow-purple-500/30 hover:bg-purple-400 transition-all z-10",children:[e.jsx(he,{size:14}),o," new message",o>1?"s":""]})}),e.jsx(T,{children:h.length>0&&e.jsx(b.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"px-4 py-1.5 border-t border-white/[0.04]",children:e.jsxs("span",{className:"text-[10px] text-gray-500 italic",children:[h.join(", ")," ",h.length===1?"is":"are"," typing",e.jsxs("span",{className:"inline-flex ml-1",children:[e.jsx("span",{className:"animate-bounce",style:{animationDelay:"0ms"},children:"."}),e.jsx("span",{className:"animate-bounce",style:{animationDelay:"150ms"},children:"."}),e.jsx("span",{className:"animate-bounce",style:{animationDelay:"300ms"},children:"."})]})]})})}),e.jsx("form",{onSubmit:I,className:"p-3 bg-white/[0.03] border-t border-white/[0.06]",children:e.jsxs("div",{className:"relative flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:k,value:r,onChange:s=>{s.target.value.length<=u&&(n(s.target.value),A()),z()},onKeyDown:M,placeholder:"Send a message…",rows:1,className:"w-full bg-white/[0.04] border border-white/[0.08] rounded-2xl pl-4 pr-4 py-2.5 text-white placeholder-gray-600 focus:outline-none focus:border-purple-500/30 focus:ring-1 focus:ring-purple-500/20 transition-all text-sm resize-none min-h-[40px] max-h-[120px] custom-scrollbar",style:{height:"40px"}}),r.length>u*.8&&e.jsxs("span",{className:`absolute right-3 bottom-2 text-[9px] font-mono ${r.length>=u?"text-red-400":"text-gray-500"}`,children:[r.length,"/",u]})]}),e.jsx("button",{type:"submit",disabled:!r.trim(),className:"p-2.5 bg-purple-500 text-white rounded-xl hover:bg-purple-400 active:scale-90 disabled:opacity-30 disabled:hover:bg-purple-500 disabled:active:scale-100 transition-all duration-200 shadow-lg shadow-purple-500/20 shrink-0",children:e.jsx(Y,{size:16,className:r.trim()?"translate-x-0.5 -translate-y-0.5":""})})]})})]})},Z=()=>{const{currentRoom:a,kickParticipant:t}=E(),{user:x}=$(),[r,n]=i.useState(null);if(!a)return null;const m=a.hostId===(x==null?void 0:x.id),c=(o,f)=>{t(o),L.success(`${f} was removed from the room`),n(null)};return e.jsxs("div",{className:"bg-white/[0.02] backdrop-blur-sm rounded-2xl border border-white/[0.06] flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"px-4 py-3 border-b border-white/[0.06] bg-white/[0.03]",children:e.jsxs("h3",{className:"font-bold text-white uppercase tracking-wider text-xs flex items-center justify-between",children:["Participants",e.jsx("span",{className:"bg-white/[0.08] text-gray-300 px-2.5 py-0.5 rounded-full text-[10px] font-bold",children:a.participants.length})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar",children:a.participants.map(o=>{const f=o.id===(x==null?void 0:x.id),h=r===o.id;return e.jsxs(b.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},className:"group flex items-center justify-between p-2.5 hover:bg-white/[0.04] rounded-xl transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:o.avatar,alt:o.username,className:"w-9 h-9 rounded-full bg-dark-bg"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-[#0a0a0f]"})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-medium text-white text-sm flex items-center gap-1.5",children:[o.username,o.role==="owner"&&e.jsx(ue,{size:11,className:"text-yellow-500 fill-yellow-500"}),f&&e.jsx("span",{className:"text-[9px] text-gray-500 bg-white/[0.06] px-1.5 py-0.5 rounded font-medium",children:"you"})]}),e.jsx("p",{className:"text-[10px] text-gray-600 capitalize",children:o.role})]})]}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`p-1.5 rounded-lg ${o.isMuted?"text-red-400/60 bg-red-500/5":"text-green-400/80 bg-green-500/5"}`,children:o.isMuted?e.jsx(R,{size:11}):e.jsx(P,{size:11})}),m&&!f&&e.jsx(e.Fragment,{children:h?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>c(o.id,o.username),className:"px-2 py-1 bg-red-500 text-white text-[10px] font-bold rounded-lg hover:bg-red-600 transition-all",children:"Kick"}),e.jsx("button",{onClick:()=>n(null),className:"px-2 py-1 bg-white/[0.06] text-gray-400 text-[10px] font-bold rounded-lg hover:bg-white/[0.1] transition-all",children:"No"})]}):e.jsx("button",{onClick:()=>n(o.id),className:"p-1.5 opacity-0 group-hover:opacity-100 hover:bg-red-500/10 text-gray-500 hover:text-red-400 rounded-lg transition-all duration-200",title:"Kick User",children:e.jsx(pe,{size:13})})})]})]},o.id)})})]})},Me=({isOpen:a,onClose:t})=>{const{friends:x}=we(),{inviteUser:r,currentRoom:n}=E(),[m,c]=i.useState(""),[o,f]=i.useState([]),[h,y]=i.useState(!1),v=x.filter(l=>l.username.toLowerCase().includes(m.toLowerCase())&&l.status!=="offline"),g=l=>{r(l),f(u=>[...u,l.id])},k=()=>{const l=`${window.location.origin}/party/${(n==null?void 0:n.id)||""}`;navigator.clipboard.writeText(l),y(!0),L.success("Invite link copied!"),setTimeout(()=>y(!1),2e3)};return e.jsx(T,{children:a&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:15},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:15},transition:{duration:.2},className:"relative w-full max-w-lg bg-[#131320] border border-white/[0.08] rounded-2xl shadow-2xl overflow-hidden",children:[e.jsxs("div",{className:"p-5 border-b border-white/[0.06] flex items-center justify-between bg-white/[0.02]",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Invite Friends"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/[0.06] rounded-xl text-gray-500 hover:text-white transition-all duration-200",children:e.jsx(K,{size:18})})]}),e.jsx("div",{className:"px-5 pt-4",children:e.jsxs("button",{onClick:k,className:`w-full flex items-center justify-center gap-2 px-4 py-3 rounded-xl border text-sm font-medium transition-all duration-200 ${h?"bg-green-500/10 border-green-500/20 text-green-400":"bg-white/[0.04] border-white/[0.06] text-gray-300 hover:bg-white/[0.06] hover:text-white"}`,children:[h?e.jsx(U,{size:16}):e.jsx(be,{size:16}),h?"Copied!":"Copy Invite Link"]})}),e.jsx("div",{className:"p-5 border-b border-white/[0.06]",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-600",size:16}),e.jsx("input",{type:"text",placeholder:"Search online friends…",value:m,onChange:l=>c(l.target.value),className:"w-full bg-white/[0.04] text-white rounded-xl pl-10 pr-4 py-2.5 border border-white/[0.06] focus:outline-none focus:ring-2 focus:ring-purple-500/30 focus:border-purple-500/30 text-sm transition-all"})]})}),e.jsx("div",{className:"max-h-[350px] overflow-y-auto p-2 custom-scrollbar",children:v.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-14 h-14 bg-white/[0.04] rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(W,{size:24,className:"text-gray-600"})}),e.jsx("p",{className:"text-gray-500 text-sm",children:m?"No friends found":"No online friends to invite"})]}):e.jsx("div",{className:"space-y-0.5",children:v.map(l=>{const u=o.includes(l.id);return e.jsxs("div",{className:"flex items-center justify-between p-3 hover:bg-white/[0.04] rounded-xl transition-all duration-200",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:l.avatar,alt:l.username,className:"w-9 h-9 rounded-full bg-dark-bg"}),e.jsx("div",{className:"absolute -bottom-0.5 -right-0.5 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-[#131320]"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white text-sm",children:l.username}),e.jsx("p",{className:"text-[10px] text-green-400",children:"Online"})]})]}),e.jsx("button",{onClick:()=>g(l),disabled:u,className:`px-3.5 py-1.5 rounded-lg text-xs font-bold transition-all duration-200 flex items-center gap-1.5 ${u?"bg-green-500/10 text-green-400 border border-green-500/20":"bg-purple-500 hover:bg-purple-400 text-white shadow-lg shadow-purple-500/20 active:scale-95"}`,children:u?e.jsxs(e.Fragment,{children:[e.jsx(U,{size:12})," Sent"]}):e.jsxs(e.Fragment,{children:[e.jsx(W,{size:12})," Invite"]})})]},l.id)})})})]})]})})},$e=({isOpen:a,onClose:t})=>{const{t:x}=Se(),{updateAnime:r,currentRoom:n}=E(),[m,c]=i.useState(""),[o,f]=i.useState([]),[h,y]=i.useState(!1),[v,g]=i.useState(null);i.useEffect(()=>{const l=async()=>{y(!0);try{const{data:u}=await ee.get("/anime",{params:{search:m}});u.success&&f(Array.isArray(u.data)?u.data:u.data.anime||[])}catch(u){console.error("Failed to fetch anime:",u)}finally{y(!1)}};if(a){const u=setTimeout(l,300);return()=>clearTimeout(u)}},[m,a]);const k=()=>{v&&(r(v.id),n&&N.emit("room:update_anime",{roomId:n.id,animeId:v.id}),g(null),t())};return e.jsx(T,{children:a&&e.jsxs("div",{className:"fixed inset-0 z-[60] flex items-center justify-center px-4",children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"absolute inset-0 bg-black/70 backdrop-blur-sm"}),e.jsxs(b.div,{initial:{opacity:0,scale:.95,y:15},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.95,y:15},transition:{duration:.2},className:"relative w-full max-w-2xl bg-[#131320] border border-white/[0.08] rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]",children:[e.jsxs("div",{className:"p-5 border-b border-white/[0.06] flex items-center justify-between bg-white/[0.02]",children:[e.jsx("h2",{className:"text-lg font-bold text-white",children:"Select Anime"}),e.jsx("button",{onClick:t,className:"p-2 hover:bg-white/[0.06] rounded-xl transition-all text-gray-500 hover:text-white",children:e.jsx(K,{size:18})})]}),e.jsx("div",{className:"p-5 border-b border-white/[0.06]",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 text-gray-600",size:16}),e.jsx("input",{type:"text",value:m,onChange:l=>c(l.target.value),placeholder:"Search for anime…",className:"w-full bg-white/[0.04] border border-white/[0.06] rounded-xl py-2.5 pl-10 pr-4 text-white text-sm focus:outline-none focus:border-purple-500/30 focus:ring-2 focus:ring-purple-500/20 transition-all"})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto p-5 custom-scrollbar",children:h?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:[1,2,3,4,5,6].map(l=>e.jsx("div",{className:"aspect-[3/4] bg-white/[0.04] rounded-xl animate-pulse"},l))}):o.length>0?e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-4",children:o.map(l=>e.jsxs(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>g(l),className:"group relative aspect-[3/4] rounded-xl overflow-hidden bg-dark-bg cursor-pointer text-left border border-white/[0.04] hover:border-white/[0.12] transition-all duration-200",children:[e.jsx("img",{src:l.thumbnail_url,alt:l.title,className:"w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"}),e.jsxs("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-100 sm:opacity-0 sm:group-hover:opacity-100 transition-opacity flex flex-col justify-end p-3",children:[e.jsx("h3",{className:"font-bold text-white text-sm line-clamp-2 mb-1.5",children:l.title}),e.jsxs("div",{className:"flex items-center gap-1.5 text-purple-400 text-xs font-bold uppercase tracking-wider",children:[e.jsx(B,{size:10,fill:"currentColor"})," Select"]})]})]},l.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-14 h-14 bg-white/[0.04] rounded-2xl flex items-center justify-center mx-auto mb-3",children:e.jsx(_,{size:24,className:"text-gray-600"})}),e.jsx("p",{className:"text-gray-500 text-sm",children:m?`No anime found for "${m}"`:"Search for an anime to watch"})]})})]}),e.jsx(T,{children:v&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-black/50 flex items-center justify-center z-10 p-4",onClick:()=>g(null),children:e.jsxs(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:l=>l.stopPropagation(),className:"bg-[#151520] border border-white/[0.08] rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2 bg-orange-500/10 border border-orange-500/20 rounded-xl",children:e.jsx(te,{size:16,className:"text-orange-400"})}),e.jsx("h3",{className:"font-bold text-white",children:"Change Anime?"})]}),e.jsxs("p",{className:"text-gray-400 text-sm mb-2",children:["Switch to ",e.jsx("span",{className:"text-white font-semibold",children:v.title}),"?"]}),e.jsx("p",{className:"text-gray-500 text-xs mb-5",children:"This will reset playback for everyone in the room."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>g(null),className:"px-4 py-2 bg-white/[0.06] hover:bg-white/[0.1] border border-white/[0.08] rounded-xl text-sm font-medium text-gray-300 transition-all duration-200",children:"Cancel"}),e.jsxs("button",{onClick:k,className:"px-4 py-2 bg-purple-500 hover:bg-purple-400 rounded-xl text-sm font-bold text-white shadow-lg shadow-purple-500/20 transition-all duration-200 active:scale-95",children:[e.jsx(B,{size:12,fill:"currentColor",className:"inline mr-1"}),"Confirm"]})]})]})})})]})})},_e=()=>{var q,H;const{roomId:a}=fe(),t=ge(),{user:x}=oe(),{user:r,initUser:n}=$(),{joinRoom:m,currentRoom:c,leaveRoom:o,isRoomLoading:f}=E(),[h,y]=i.useState("chat"),[v,g]=i.useState(!1),[k,l]=i.useState(!1),[u,d]=i.useState(!1),[S,A]=i.useState(!1),[z,I]=i.useState(""),[M,s]=i.useState(!1),[p,C]=i.useState(!1);i.useEffect(()=>{n(x)},[x,n]),i.useEffect(()=>(r&&a&&(async()=>{try{c||await m(a,r),Ae(),Ee(a,r),w.initialize(r.id),await w.getLocalStream()}catch(D){console.error(D),L.error("Failed to join room"),t("/party")}})(),()=>{O(),w.destroy()}),[a,r,m,t]);const se=()=>{o(),O(),w.destroy(),t("/party")},ae=()=>{z==="DELETE"&&(N.emit("room:delete",{roomId:c==null?void 0:c.id}),o(),O(),w.destroy(),L.success("Room deleted"),t("/party"))},re=()=>{navigator.clipboard.writeText((c==null?void 0:c.id)||""),C(!0),L.success("Room ID copied!"),setTimeout(()=>C(!1),2e3)};if(!r||f)return e.jsx("div",{className:"min-h-screen bg-[#0a0a0f] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-2 border-purple-500/30 border-t-purple-500 rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-sm font-medium animate-pulse",children:"Joining room…"})]})});const ie=((q=c==null?void 0:c.participants.find(j=>j.id===r.id))==null?void 0:q.role)==="owner";return e.jsxs("div",{className:"min-h-screen bg-[#0a0a0f] text-white overflow-hidden flex flex-col",children:[e.jsx("div",{className:"fixed top-0 w-full z-50",children:e.jsx(ce,{})}),e.jsxs("div",{className:"flex-1 flex overflow-hidden pt-20",children:[e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 p-4 gap-4 overflow-y-auto custom-scrollbar",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>d(!0),className:"p-2.5 bg-white/[0.04] hover:bg-red-500/10 border border-white/[0.06] hover:border-red-500/20 rounded-xl transition-all duration-200 text-gray-400 hover:text-red-400 group",children:e.jsx(je,{size:18})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("h1",{className:"font-bold text-lg tracking-tight",children:["Watch ",e.jsx("span",{className:"text-purple-400",children:"Party"})]}),e.jsx("span",{className:"text-gray-600",children:"•"}),e.jsxs("button",{onClick:re,className:"flex items-center gap-1.5 px-3 py-1 bg-white/[0.04] border border-white/[0.06] rounded-lg hover:bg-white/[0.08] transition-all duration-200 group",children:[e.jsx("span",{className:"text-gray-400 font-mono text-xs",children:a}),p?e.jsx(U,{size:12,className:"text-green-400"}):e.jsx(ye,{size:12,className:"text-gray-500 group-hover:text-gray-300"})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[e.jsx("div",{className:"w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"}),e.jsxs("span",{className:"text-[10px] text-gray-500",children:[((H=c==null?void 0:c.participants)==null?void 0:H.length)||0," connected"]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ie&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>l(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-purple-500/10 border border-purple-500/20 text-purple-400 hover:bg-purple-500/20 rounded-xl transition-all duration-200 font-medium text-sm",children:[e.jsx(B,{size:14,fill:"currentColor"}),e.jsx("span",{className:"hidden sm:inline",children:"Change Anime"})]}),e.jsx("button",{onClick:()=>A(!0),className:"p-2.5 bg-red-500/5 border border-red-500/10 text-red-400/60 hover:bg-red-500/10 hover:text-red-400 hover:border-red-500/20 rounded-xl transition-all duration-200",title:"Delete Room",children:e.jsx(X,{size:16})})]}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center gap-2 px-4 py-2.5 bg-primary/10 border border-primary/20 text-primary hover:bg-primary/20 rounded-xl transition-all duration-200 font-medium text-sm",children:[e.jsx(ve,{size:14}),e.jsx("span",{className:"hidden sm:inline",children:"Invite"})]}),e.jsx("button",{onClick:()=>s(!0),className:"lg:hidden p-2.5 bg-white/[0.04] border border-white/[0.06] rounded-xl hover:bg-white/[0.08] transition-all duration-200",children:e.jsx(F,{size:16,className:"text-gray-400"})})]})]}),e.jsx("div",{className:"w-full shrink-0",children:e.jsx(ze,{animeId:(c==null?void 0:c.animeId)||"demo"})}),e.jsx("div",{className:"flex-1 min-h-[200px]",children:e.jsx(Ie,{})})]}),e.jsxs("div",{className:"hidden lg:flex w-80 xl:w-96 border-l border-white/[0.06] bg-white/[0.01] flex-col shrink-0",children:[e.jsx("div",{className:"flex border-b border-white/[0.06]",children:[{key:"chat",label:"Chat",icon:F},{key:"participants",label:"People",icon:G}].map(j=>{var D;return e.jsxs("button",{onClick:()=>y(j.key),className:`flex-1 py-3.5 text-xs font-bold uppercase tracking-wider transition-all duration-200 relative ${h===j.key?"text-purple-400 bg-purple-500/5":"text-gray-500 hover:text-gray-300 hover:bg-white/[0.02]"}`,children:[e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(j.icon,{size:14}),j.label,j.key==="participants"&&e.jsx("span",{className:"bg-white/[0.08] px-1.5 py-0.5 rounded text-[10px]",children:((D=c==null?void 0:c.participants)==null?void 0:D.length)||0})]}),h===j.key&&e.jsx(b.div,{layoutId:"tab-indicator",className:"absolute bottom-0 left-0 right-0 h-0.5 bg-purple-500"})]},j.key)})}),e.jsx("div",{className:"flex-1 overflow-hidden p-4 relative",children:e.jsx(T,{mode:"wait",children:h==="chat"?e.jsx(b.div,{initial:{opacity:0,x:15},animate:{opacity:1,x:0},exit:{opacity:0,x:-15},transition:{duration:.15},className:"h-full",children:e.jsx(Q,{})},"chat"):e.jsx(b.div,{initial:{opacity:0,x:15},animate:{opacity:1,x:0},exit:{opacity:0,x:-15},transition:{duration:.15},className:"h-full",children:e.jsx(Z,{})},"participants")})})]}),e.jsx(T,{children:M&&e.jsxs(e.Fragment,{children:[e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:()=>s(!1),className:"fixed inset-0 bg-black/60 backdrop-blur-sm z-40 lg:hidden"}),e.jsxs(b.div,{initial:{x:"100%"},animate:{x:0},exit:{x:"100%"},transition:{type:"spring",damping:25,stiffness:250},className:"fixed right-0 top-0 bottom-0 w-[85%] max-w-[400px] bg-[#0f0f18] border-l border-white/[0.06] z-50 flex flex-col lg:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-white/[0.06]",children:[e.jsx("h3",{className:"font-bold text-white",children:"Chat & People"}),e.jsx("button",{onClick:()=>s(!1),className:"p-2 hover:bg-white/[0.06] rounded-xl transition-colors",children:e.jsx(K,{size:18,className:"text-gray-400"})})]}),e.jsxs("div",{className:"flex border-b border-white/[0.06]",children:[e.jsxs("button",{onClick:()=>y("chat"),className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider ${h==="chat"?"text-purple-400 border-b-2 border-purple-500":"text-gray-500"}`,children:[e.jsx(F,{size:14,className:"inline mr-1"})," Chat"]}),e.jsxs("button",{onClick:()=>y("participants"),className:`flex-1 py-3 text-xs font-bold uppercase tracking-wider ${h==="participants"?"text-purple-400 border-b-2 border-purple-500":"text-gray-500"}`,children:[e.jsx(G,{size:14,className:"inline mr-1"})," People"]})]}),e.jsx("div",{className:"flex-1 overflow-hidden p-4",children:h==="chat"?e.jsx(Q,{}):e.jsx(Z,{})})]})]})})]}),e.jsx(Me,{isOpen:v,onClose:()=>g(!1)}),e.jsx($e,{isOpen:k,onClose:()=>l(!1)}),e.jsx(T,{children:u&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>d(!1),children:e.jsxs(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:j=>j.stopPropagation(),className:"bg-[#151520] border border-white/[0.08] rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2.5 bg-orange-500/10 border border-orange-500/20 rounded-xl",children:e.jsx(J,{size:18,className:"text-orange-400"})}),e.jsx("h3",{className:"text-lg font-bold text-white",children:"Leave Room?"})]}),e.jsx("p",{className:"text-gray-400 text-sm mb-6",children:"You'll be disconnected from the watch party. You can rejoin later with the room ID."}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>d(!1),className:"px-5 py-2.5 bg-white/[0.06] hover:bg-white/[0.1] border border-white/[0.08] rounded-xl text-sm font-medium text-gray-300 transition-all duration-200",children:"Cancel"}),e.jsxs("button",{onClick:()=>{d(!1),se()},className:"px-5 py-2.5 bg-red-500 hover:bg-red-600 rounded-xl text-sm font-bold text-white shadow-lg shadow-red-500/20 transition-all duration-200 active:scale-95",children:[e.jsx(J,{size:14,className:"inline mr-1.5"}),"Leave"]})]})]})})}),e.jsx(T,{children:S&&e.jsx(b.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black/70 backdrop-blur-sm z-50 flex items-center justify-center p-4",onClick:()=>A(!1),children:e.jsxs(b.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},onClick:j=>j.stopPropagation(),className:"bg-[#151520] border border-red-500/20 rounded-2xl p-6 max-w-sm w-full",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"p-2.5 bg-red-500/10 border border-red-500/20 rounded-xl",children:e.jsx(te,{size:18,className:"text-red-400"})}),e.jsx("h3",{className:"text-lg font-bold text-red-400",children:"Delete Room"})]}),e.jsxs("p",{className:"text-gray-400 text-sm mb-4",children:["This will permanently close the room and disconnect all participants. Type ",e.jsx("span",{className:"text-red-400 font-mono font-bold",children:"DELETE"})," to confirm."]}),e.jsx("input",{type:"text",value:z,onChange:j=>I(j.target.value),placeholder:"Type DELETE",className:"w-full bg-dark-accent border border-red-500/20 rounded-xl px-4 py-2.5 text-white placeholder:text-gray-600 focus:outline-none focus:ring-2 focus:ring-red-500/30 font-mono text-sm mb-4"}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{onClick:()=>{A(!1),I("")},className:"px-5 py-2.5 bg-white/[0.06] hover:bg-white/[0.1] border border-white/[0.08] rounded-xl text-sm font-medium text-gray-300 transition-all duration-200",children:"Cancel"}),e.jsxs("button",{onClick:ae,disabled:z!=="DELETE",className:"px-5 py-2.5 bg-red-500 hover:bg-red-600 rounded-xl text-sm font-bold text-white shadow-lg shadow-red-500/20 transition-all duration-200 active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed disabled:active:scale-100",children:[e.jsx(X,{size:14,className:"inline mr-1.5"}),"Delete Room"]})]})]})})})]})};export{_e as default};
